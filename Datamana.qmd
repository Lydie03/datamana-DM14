---
title: "Data Management Project"
author : Lou Dhiver and Lydie Lazure 
format: html
---
## Presentation of the project
We have decided to test the environmental Kuznet's curve theory. The idea is that a country will pollute a lot for a while in order to develop, and then reach a sufficient level of economic development to decrease its carbon dioxyde emissions. We would then get an inverted u shaped line in the plan (GDP per capita, pollution). 

We wish to very the empirical accuracy of this theory, both by regions and periods of times. Does is apply to different economical structures ? Does it apply at any time over the years ? 

We will then consider the subject around a more human matter. Pollution to the cost of a population's health : an impact on GDP ? And if so, can we quantify it ? 

## Loading the datasets
```{r}
library(tidyr)
library(vroom)

DALYs <- vroom::vroom("DALYs.csv")
death_air_pollution <- vroom::vroom("death-air-pollution.csv")
SDG <- vroom::vroom("SDG indicators.csv")
GDP_per_capita <- vroom::vroom("GDPperCapita.csv", delim=",")
```
## Data cleaning

### GDP per capita
By trying to get the column names of this dataset, we observed that it did not load properly. There were the first four row of the Excel sheet presenting the data, hence compromising the understanding of the separator ",". We removed the first four rows that did not contain any data and got a proper dataset to work with. 
```{r}
GDP_per_capita_cleaned <- vroom::vroom("GDPperCapita.csv", skip = 4, delim=",") 
```
### DALYs
This dataset is hard to work with in the sense that the columns have non explicit names. hence the following changes. 

```{r}
library(dplyr)

DALYs <- DALYs %>%
  rename(
    Mean_Value = FactValueNumeric,
    lowest_value = FactValueNumericLow,
    highest_value = FactValueNumericHigh,
    Sex = Dim1,
    Country = Location
  )
```

### Death air pollution and SDG
The observations are the same as for DALYs, hence the following changes.

```{r}
SDG <- SDG %>%
  rename(
    Mean_Value = FactValueNumeric,
    lowest_value = FactValueNumericLow,
    highest_value = FactValueNumericHigh,
    Sex = Dim1,
    Country = Location
  )
```

```{r}
death_air_pollution <- death_air_pollution %>%
  rename(
    Mean_Value = FactValueNumeric,
    lowest_value = FactValueNumericLow,
    highest_value = FactValueNumericHigh,
    Sex = Dim1,
    Country = Location
  )
```


## Data description

To answer our research question, we will need data around pollution, GDP per capita and health. 
To this end, we will be working with databases from the World Health Organization, and the World Bank. 

References are listed in the appendix. 

### DALYs
This aggregated indicator is extracted from the World Health Organization database. It is described as follows : "DALYs for a disease or health condition are the sum of the years of life lost to due to premature mortality (YLLs) and the years lived with a disability (YLDs) due to prevalent cases of the disease or health condition in a population". 
We will mostly use the variable cross countries, classified into regions (Africa, Eastern Europe, Asia, North and South America), by sex (male/female), by year (2010 to 2019) and by cause of death (cancer, trachea etc.). 
This will allow us to evaluate possible external factors, such as armed conflicts, that might have had an impact on spoecific regions during a specific year. 

This dataset will then be compared to pollution to answer our final sub research question : can a country observe long term growth while polluting despite the negative externalities in terms of health ? 

```{r}
head(DALYs)
summary(DALYs)

library(ggplot2)

# Grouping mean over time per country
DALYs_unique <- DALYs %>%
  group_by(ParentLocation) %>%
  summarise(Mean_Value = mean(Mean_Value))

# Graphical representation
ggplot(data = DALYs_unique, aes(x = ParentLocation, y = Mean_Value, group = 1)) +
  geom_line()
```
When we group the mean of DALYs values obver time per country, we get a rather interesting picture of the situation cross regions. It seems DAILYs are prevazlent in Africa, Eastern Mediterranea and South East Asia. This will allow us to define control groups and to consider levels of development compared to DALYs. 

### Death air pollution
This data set will be used to complete DALYs. It also comes from the World Health Organization and is organized with the same categories and classifications. 
It will allow us to get a more precise analysis on the effect of carbone emissions on health. 

```{r}
head(death_air_pollution)
summary(death_air_pollution)

library(ggplot2)

# Grouping mean over time per country
death_air_pollution_unique <- death_air_pollution %>%
  group_by(ParentLocation) %>%
  summarise(Mean_Value = mean(Mean_Value))

# Graphical representation
ggplot(data = death_air_pollution_unique, aes(x = ParentLocation, y = Mean_Value, group = 1)) +
  geom_line()
```
Here it seems deaths due to air pollution is prevalent in South East Asia and Western Pacific. 

### SDG
This dataset includes the measurement of fine particulate matter, that is to say the concentration of toxic elements in the air. Again, since the dataset comes from the World Health organization, the classification remains the same. It will allow us to get a cross country analysis, from 2010 to 2019.
We will compare the degree to which some regions are polluted and their GDP over the year.

```{r}
head(SDG)
summary(SDG)

library(ggplot2)

# Grouping mean over time per country
SDG_unique <- SDG %>%
  group_by(ParentLocation) %>%
  summarise(Mean_Value = mean(Mean_Value))

# Graphical representation
ggplot(data = SDG_unique, aes(x = ParentLocation, y = Mean_Value, group = 1)) +
  geom_line()
```
The pattern here is quite similar to DALYs. SDG is prevalent in Africa, Eastern Mediterrenea and South East Asia. 

### GDP per capita
GDP (Gross domestic product) is obtained with the following macroeconomics formula :
`GDP=C+I+G+(Xâˆ’M)`
That is to say the aggregation of consumption (C), investments (I), government spendings (G) and the commercial balance (exportations minus importations).
GDP per capita is the previous aggregate divided by the population size. Thiw choice will allow us to correct for countries size bias. 

GDP will be our wealth indicator in the simulation of the Kuznet's environmental curve. 

```{r}
head(GDP_per_capita_cleaned)
summary(GDP_per_capita_cleaned)

library(ggplot2)

## Filtering per region
rows_to_keep <- c(182, 216, 231, 232, 237, 241, 260)

GDP_per_capita_cleaned_filtered <- GDP_per_capita_cleaned %>%
  slice(rows_to_keep)

## Mean over time per region
mean_values <- rowMeans(GDP_per_capita_cleaned_filtered[, 5:50], na.rm = TRUE)

GDP_per_capita_cleaned_filtered$Mean_5_to_50 <- mean_values

ggplot(data = GDP_per_capita_cleaned_filtered, aes(x = `Country Name`, y = Mean_5_to_50)) +
  geom_line()

```

